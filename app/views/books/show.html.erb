
<%= flash[:create] %>
<%= flash[:update] %>

<div class="container">
  <div class="row">
    <div class="col-md-3">

    <%= render 'users/profile', user: @user %>

    <!--######################################################-->
    <%= render 'books/list', books: @new %>
    </div>
    <!--######################################################-->

    <div class="col-md-8 offset-md-1">
    <h2>Book detail</h2>

    <table class="table table-striped">
      <thead>
        <tr>
          <th>&nbsp;&nbsp;&nbsp;</th>
          <th>Title</th>
          <th>Opinion</th>
          <th>like</th>
          <th>Comment</th>
          <th>&nbsp;&nbsp;&nbsp;</th>
          <th>&nbsp;&nbsp;&nbsp;</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            <%= attachment_image_tag @user, :profile_image, :fill, 60, 60, fallback: "noimage.jpg" %>
          </td>
          <td>
            <%= @book.title %>
          </td>
          <td>
            <%= @book.body %>
          </td>
          <td>
            <% if @book.favorited_by?(current_user) %>
              <%= link_to @book.favorites.count, book_favorites_path(@book), method: :delete, class: "fas fa-heart heart_red" %>
            <% else %>
              <%= link_to @book.favorites.count, book_favorites_path(@book), method: :post, class: "fas fa-heart heart_blue" %>
            <% end %>
          </td>
          <td>Comments: <%= @book.book_comments.count %></td>



          <% if @user.id == current_user.id %>
          <td>
            <%= link_to 'Edit', edit_book_path(@book), class: "btn btn-success" %>
          </td>
          <td>
            <%= link_to 'Destroy', book_path(@book.id), class: "btn btn-danger", method: :delete, "data-confirm" => "本当に消しますか？"  %>
          </td>
          <% end %>
        </tr>
        <tr>
          <td>
            <%= link_to @user.name ,user_path(@user.id) %>
          </td>
        </tr>
      </tbody>
    </table>
    <!--******************************************************************************************-->

    <table>
    <% @book.book_comments.each do |book_comment| %>
    <% book_comment_user = book_comment.user %>
      <tr>
        <td>
    		<%= link_to user_path(book_comment_user), class: "user_#{book_comment_user.id}" do %>
      		<%= attachment_image_tag book_comment_user, :profile_image, :fill, 60, 60, fallback: "no_image.jpg", size: "60x60" %><br>
      		<%= book_comment_user.name %>
    		<% end %>
    	　</td>
      	<td><%= book_comment.comment %></td>
    	  <% if current_user == book_comment_user %>
      	  <td><%= link_to 'Destroy', book_book_comment_path(book_comment.book_id, book_comment.id), class: 'btn-sm btn-danger', method: :delete %></td>
    	  <% end %>
      </tr>
    <% end %>
    </table>

    <!--******************************************************************************************-->

    <div class="new-comment">
    <%= form_with(model:[@book, @book_comment], local: true) do |f| %>
      <%= f.text_area :comment, rows:'5',placeholder: "Please fill in here...",size:"90x3" %>
      <br><%= f.submit "送信する" %>
    <% end %>
    </div>
    </div>
  </div>
</div>